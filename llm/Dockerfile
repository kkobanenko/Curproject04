FROM ollama/ollama:latest

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º curl (bash —É–∂–µ –µ—Å—Ç—å –≤ Ubuntu)
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
COPY init_models.sh /init_models.sh
RUN chmod +x /init_models.sh

# –°–æ–∑–¥–∞–µ–º entrypoint —Å–∫—Ä–∏–ø—Ç —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º CPU —è–¥–µ—Ä
RUN echo '#!/bin/bash' > /entrypoint.sh && \
    echo 'set -e' >> /entrypoint.sh && \
    echo '# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä' >> /entrypoint.sh && \
    echo 'export OLLAMA_NUM_PARALLEL=${OLLAMA_NUM_PARALLEL:-4}' >> /entrypoint.sh && \
    echo 'export OLLAMA_MAX_LOADED_MODELS=${OLLAMA_MAX_LOADED_MODELS:-1}' >> /entrypoint.sh && \
    echo 'echo "üöÄ –ó–∞–ø—É—Å–∫ Ollama —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º: ${OLLAMA_NUM_PARALLEL} –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤"' >> /entrypoint.sh && \
    echo '/bin/ollama serve &' >> /entrypoint.sh && \
    echo 'sleep 5' >> /entrypoint.sh && \
    echo '/init_models.sh' >> /entrypoint.sh && \
    echo 'wait' >> /entrypoint.sh && \
    chmod +x /entrypoint.sh

# –ò—Å–ø–æ–ª—å–∑—É–µ–º entrypoint –≤–º–µ—Å—Ç–æ CMD
ENTRYPOINT ["/entrypoint.sh"]